<!doctype html><html lang=en-gb><head><title>Play with Stanford CoreNLP's Simple API // Manos Nikolaidis</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.109.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Manos Nikolaidis"><meta name=description content="English grammar with Java instead of a universal translator"><link rel=stylesheet href=/css/main.min.c579b5c218f95251df1fca671436654e2746fa72fc6af50f0d5a372576ae6213.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Play with Stanford CoreNLP's Simple API"><meta name=twitter:description content="English grammar with Java instead of a universal translator"><meta property="og:title" content="Play with Stanford CoreNLP's Simple API"><meta property="og:description" content="English grammar with Java instead of a universal translator"><meta property="og:type" content="article"><meta property="og:url" content="https://shadowmanos.github.io/tutorials/naturallanguage/corennlpintro/"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2023-01-04T13:04:44+00:00"></head><body><header class=app-header><a href=https://shadowmanos.github.io><img class=app-header-avatar src=/avatar.jpg alt="Manos Nikolaidis"></a>
<span class=app-header-title>Manos Nikolaidis</span><nav class=app-header-menu><a class=app-header-menu-item href=/>Home</a>
-
<a class=app-header-menu-item href=/about/>About</a>
-
<a class=app-header-menu-item href=/cv/>CV</a>
-
<a class=app-header-menu-item href=/exploredatawithjava/>Explore data with Java</a></nav><p>Software Engineer</p><div class=app-header-social><a href=https://stackoverflow.com/users/1413133/manos-nikolaidis target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 32 32" width="64" height="64" fill="none" color="#b5b17f" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link"><path d="M28.16 32H2.475V20.58H5.32v8.575h19.956V20.58h2.884z"/><path d="M8.477 19.8l13.993 2.923.585-2.806-13.993-2.923zm1.832-6.704 12.94 6.04 1.208-2.572-12.94-6.08zm3.586-6.353 10.99 9.12 1.832-2.183-10.99-9.12zM20.99.0l-2.3 1.715 8.536 11.46 2.3-1.715zM8.166 26.27H22.43v-2.845H8.166v2.845z"/></svg></a><a href=https://www.linkedin.com/in/manosnikolaidis target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" color="#b5b17f" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin"><title>LinkedIn</title><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Play with Stanford CoreNLP's Simple API</h1><h2 class=post-description>English grammar with Java instead of a universal translator</h2><div class=post-meta><div><svg viewBox="0 0 24 24" fill="none" color="#b5b17f" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Jan 4, 2023</div><div><svg viewBox="0 0 24 24" fill="none" color="#b5b17f" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>7 min read</div></div></header><div class=post-content><h3 id=core-what-now>Core what now?</h3><p><a href=https://stanfordnlp.github.io/CoreNLP/>CoreNLP</a> is a Natural Language Processing library written in Java by some
lovely people at Stanford University and available under a GPL or commercial license. You can build Java applications
with it, use it through a REST API from any language or invoke through your OS command line. CoreNLP recently introduced
an alternative <a href=https://stanfordnlp.github.io/CoreNLP/simple.html>Simple API</a> which is simple and concise and ideal for
a REPL.
To run these commands make sure you have <a href=https://github.com/maxandersen/jbang#installation>installed j&rsquo;bang</a> and then
at your terminal do:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>jbang -i https://github.com/shadowmanos/explore-data-with-java/blob/master/tutorials/naturalLanguage/corenNLPIntro.jsh
</span></span></code></pre></div><h3 id=documents-sentences-and-words>Documents, sentences and words</h3><p>Let&rsquo;s start by creating
a <a href=https://nlp.stanford.edu/nlp/javadoc/javanlp/index.html?edu/stanford/nlp/simple/Document.html>Document</a> with
appropriate sample text for starting our journey.</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>var text = new Document(&#34;Space: the final frontier. These are the voyages of the starship Enterprise. Its continuing mission: to explore strange new worlds, to seek out new life and new civilizations, to boldly go where no one has gone before!&#34;)
</code></pre><p>The simplest processing we can do here is split the document
into <a href=https://nlp.stanford.edu/nlp/javadoc/javanlp/index.html?edu/stanford/nlp/simple/Sentence.html>sentences</a> and a
sentence into words. Note that it splits documents on punctuation like &lsquo;.&rsquo; and &lsquo;!&rsquo; if followed by a space, and it
retains the punctuation in the resulting sentences. It doesn&rsquo;t split on &lsquo;,&rsquo; or &lsquo;:&rsquo;. It splits sentences to words on
whitespace and includes punctuation marks as words. With CoreNLP we can usually get a list of results with the plural
form of a method e.g. <code>sentences()</code> or get a specific element with the singular form, and a 0-based index
e.g. <code>sentence(1)</code>. Try:</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>text.sentences().size()
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>3
</span></span></code></pre></div><p>and</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>var sentence = text.sentence(1)
</code></pre><p>We&rsquo;ll use the <code>sentence</code> variable later.</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>sentence.word(1)
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>are
</span></span></code></pre></div><h3 id=lemmas>Lemmas</h3><p>While speaking, we don&rsquo;t always use the basic, root form of a word like &ldquo;go&rdquo; but other grammatically appropriate forms
like &ldquo;goes&rdquo; or &ldquo;went&rdquo;. The basic, root form is called <a href=https://simple.wikipedia.org/wiki/Lemma_(linguistics)>lemma</a>,
and it&rsquo;s obvious from this example we can&rsquo;t always just take a substring of a word to find a lemma. We can easily find
lemmas with CoreNLP with the <code>lemma()</code> method. For example the lemma of &ldquo;are&rdquo;, second word of second sentence is &ldquo;be&rdquo;:</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>sentence.lemma(1)
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>be
</span></span></code></pre></div><p>To get the lemma of a single word make a sentence out of it e.g.</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>new Sentence(&#34;went&#34;).lemma(0)
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>go
</span></span></code></pre></div><h3 id=parts-of-speech>Parts of speech</h3><p>CoreNLP will do its best to guess whether a word is a verb, noun, adjective etc. That is a <strong>P</strong>art <strong>O</strong>f <strong>S</strong>peech
tag and you can learn more about these <a href=https://en.wikipedia.org/wiki/Part_of_speech>here</a> and see a neat list of
potential tags at <a href=https://www.ling.upenn.edu/courses/Fall_2003/ling001/penn_treebank_pos.html>Penn tree bank</a>. You
loved grammar at school didn&rsquo;t you? To get POS tags for all words in the second sentence:</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>sentence.posTags()
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[DT, VBP, DT, NNS, IN, DT, NNP, NNP, .]
</span></span></code></pre></div><p>The POS tags are in the same order as words in the sentence, which can be confusing. So lets print words and their tags
in pairs. A nice library for that purpose is <a href=https://jtablesaw.github.io/tablesaw/gettingstarted>Tablesaw</a> and has
been included for your convenience :</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>Table.create(&#34;\n&#34;).
    addColumns(
        StringColumn.create(&#34;Words&#34;, sentence.words()),
        StringColumn.create(&#34;POS tags&#34;, sentence.posTags()))
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>   Words     |  POS tags  |
</span></span><span style=display:flex><span>---------------------------
</span></span><span style=display:flex><span>      These  |        DT  |
</span></span><span style=display:flex><span>        are  |       VBP  |
</span></span><span style=display:flex><span>        the  |        DT  |
</span></span><span style=display:flex><span>    voyages  |       NNS  |
</span></span><span style=display:flex><span>         of  |        IN  |
</span></span><span style=display:flex><span>        the  |        DT  |
</span></span><span style=display:flex><span>   starship  |       NNP  |
</span></span><span style=display:flex><span> Enterprise  |       NNP  |
</span></span><span style=display:flex><span>          .  |         .  |
</span></span></code></pre></div><h3 id=graphs-of-word-relationships>Graphs of word relationships</h3><p>Now that we know that &ldquo;final&rdquo; is an adjective and &ldquo;frontier&rdquo; a noun, we&rsquo;d like to know the relationships between words,
that the adjective &ldquo;final&rdquo; modifies the noun &ldquo;frontier&rdquo; specifically in the sentence.
A <a href=https://en.wikipedia.org/wiki/Parse_tree>Parse Tree</a> is a good way to represent these relationships. With CoreNLP we
get the constituency parse tree by calling the <code>parse()</code> method on a sentence.</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>sentence.parse().pennPrint()
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>(ROOT
</span></span><span style=display:flex><span>  (S
</span></span><span style=display:flex><span>    (NP (DT These))
</span></span><span style=display:flex><span>    (VP (VBP are)
</span></span><span style=display:flex><span>      (NP
</span></span><span style=display:flex><span>        (NP (DT the) (NNS voyages))
</span></span><span style=display:flex><span>        (PP (IN of)
</span></span><span style=display:flex><span>          (NP (DT the) (NNP starship) (NNP Enterprise)))))
</span></span><span style=display:flex><span>    (. .)))
</span></span></code></pre></div><p>The output includes the words in original text, their POS tags for terminal (leaf) nodes and non terminal categories
like VP (verb phrase) or NP (noun phrase) for non terminal (non leaf) nodes.
Check <a href=https://en.wikipedia.org/wiki/Parse_tree>here</a>) for meaning of VP, NP etc.</p><p>We may also obtain a <a href=https://en.wikipedia.org/wiki/Dependency_grammar#Semantic_dependencies>Semantic Dependency</a> graph
of a sentence:</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>sentence.dependencyGraph()
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>-&gt; voyages/NNS (root)
</span></span><span style=display:flex><span>  -&gt; These/DT (nsubj)
</span></span><span style=display:flex><span>  -&gt; are/VBP (cop)
</span></span><span style=display:flex><span>  -&gt; the/DT (det)
</span></span><span style=display:flex><span>  -&gt; Enterprise/NNP (nmod:of)
</span></span><span style=display:flex><span>    -&gt; of/IN (case)
</span></span><span style=display:flex><span>    -&gt; the/DT (det)
</span></span><span style=display:flex><span>    -&gt; starship/NNP (compound)
</span></span><span style=display:flex><span>  -&gt; ./. (punct)
</span></span></code></pre></div><p>For each node we get the original word, the POS tag and a relation according
to <a href=http://universaldependencies.org/docsv1/u/dep/all.html>Universal Dependency v1</a></p><h3 id=coreference-resolution>Coreference Resolution</h3><p>In some sentences or documents two different words may refer to the same entity. CoreNLP can
perform <a href=https://en.wikipedia.org/wiki/Coreference#Coreference_resolution>Coreference Resolution</a> by calling <code>coref()</code>
on a <code>Document</code> or <code>Sentence</code>. Unfortunately coreference resolution is a challenging task and algorithms are not as
accurate as POS tagging or parsing. This shows some failed and some successful resolutions:</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>new Document(&#34;To all Starfleet personel, this is the Captain. It is my sad duty to inform you that a member of the crew, Ensign Sito Jaxa has been lost in the line of duty. She was the finest example of a Starfleet officer and a young woman of remarkable courage and strength of character. Her loss will be deeply felt by all who knew her. Picard out.&#34;).coref()
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>{5=CHAIN5-[&#34;this&#34; in sentence 1, &#34;It&#34; in sentence 2], 23=CHAIN23-[&#34;She&#34; in sentence 3, &#34;Her&#34; in sentence 4, &#34;her&#34; in sentence 4]}
</span></span></code></pre></div><p>CHAIN4 is maybe wrong as I am not sure &ldquo;this&rdquo; and &ldquo;It&rdquo; refer to the same thing. The other chain is incomplete, as "
Ensign Sito Jaxa", &ldquo;member&rdquo; should be in the chain. And it missed a chain with &ldquo;Captain&rdquo;, &ldquo;my&rdquo; and &ldquo;Picard&rdquo;.</p><h3 id=named-entity-recognition>Named Entity Recognition</h3><p>Apart from words like verbs and nouns a sentence may contain named entities that we should identify to extract useful
information from our text. <a href=https://en.wikipedia.org/wiki/Named-entity_recognition>Named Entity Recognition</a> may be
unsuccessful if the entity, and the related word are missing from
the <a href=https://en.wikipedia.org/wiki/Text_corpus>corpus</a> used to train the model the NER tagging algorithm is using. For
English, the algorithm depends a lot on the first letter being uppercase. CoreNLP performs NER tagging by calling
the <code>nerTags</code> method:</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>var iAmCaptain = new Sentence(&#34;I&#39;m Captain Jean-Luc Picard, of the Federation Starship Enterprise&#34;)

    Table.create(&#34;\n&#34;).
        addColumns(
            StringColumn.create(&#34;Words&#34;, iAmCaptain.words()),
            StringColumn.create(&#34;NER tags&#34;, iAmCaptain.nerTags()))
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>      Words     |    NER tags    |
</span></span><span style=display:flex><span>-------------------------------
</span></span><span style=display:flex><span>          I  |             O  |
</span></span><span style=display:flex><span>         &#39;m  |             O  |
</span></span><span style=display:flex><span>    Captain  |         TITLE  |
</span></span><span style=display:flex><span>       Jean  |        PERSON  |
</span></span><span style=display:flex><span>          -  |        PERSON  |
</span></span><span style=display:flex><span>        Luc  |        PERSON  |
</span></span><span style=display:flex><span>     Picard  |        PERSON  |
</span></span><span style=display:flex><span>          ,  |             O  |
</span></span><span style=display:flex><span>         of  |             O  |
</span></span><span style=display:flex><span>        the  |             O  |
</span></span><span style=display:flex><span> Federation  |  ORGANIZATION  |
</span></span><span style=display:flex><span>   Starship  |  ORGANIZATION  |
</span></span><span style=display:flex><span> Enterprise  |  ORGANIZATION  |
</span></span></code></pre></div><p>The current tokenizer in CoreNLP splits the captain&rsquo;s name in 4 words &ldquo;Jean&rdquo;, &ldquo;-&rdquo;, &ldquo;Luc&rdquo; and &ldquo;Picard&rdquo;, hence 4 <em>PERSON</em>
tags. &ldquo;Starship&rdquo; is probably more of a VEHICLE than an ORGANIZATION, so the training corpus probably didn&rsquo;t contain this
term. &ldquo;Captain&rdquo; would still be identified as &ldquo;TITLE&rdquo; even if it was typed as &ldquo;captain&rdquo;. Another example:</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>var ensignSito = new Sentence(&#34;Ensign Sito Jaxa has been lost in the line of duty&#34;)

    Table.create(&#34;\n&#34;).
        addColumns(
            StringColumn.create(&#34;Words&#34;, ensignSito.words()),
            StringColumn.create(&#34;NER tags&#34;, ensignSito.nerTags()))
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span> Words   |  NER tags  |
</span></span><span style=display:flex><span>-----------------------
</span></span><span style=display:flex><span> Ensign  |    PERSON  |
</span></span><span style=display:flex><span>   Sito  |    PERSON  |
</span></span><span style=display:flex><span>   Jaxa  |    PERSON  |
</span></span><span style=display:flex><span>    has  |         O  |
</span></span><span style=display:flex><span>   been  |         O  |
</span></span><span style=display:flex><span>   lost  |         O  |
</span></span><span style=display:flex><span>     in  |         O  |
</span></span><span style=display:flex><span>    the  |         O  |
</span></span><span style=display:flex><span>   line  |         O  |
</span></span><span style=display:flex><span>     of  |         O  |
</span></span><span style=display:flex><span>   duty  |         O  |
</span></span></code></pre></div><p>Here it successfully recognized &ldquo;Sito&rdquo; and &ldquo;Jaxa&rdquo; as names of a person despite these names probably being imaginary.</p><h3 id=sentiment-analysis>Sentiment Analysis</h3><p>This is a text categorisation task, an estimate if a sentence conveys a positive, negative or neutral sentiment. The
underlying model used by CoreNLP is based on movie reviews. If a sentence pertains to a different domain, with different
vocabulary or is rather nuanced, results can be very inaccurate. We get the sentiment of a sentence by calling
the <code>sentiment</code> method:</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>new Sentence(&#34;The war is going very badly for the Federation... far worse than is generally known&#34;).sentiment()
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>NEGATIVE
</span></span></code></pre></div><p>Some other examples, with (maybe) debatable results:</p><pre tabindex=0><code class=language-jshelllanguage data-lang=jshelllanguage>var sentences = List.of(
    &#34;Live long and prosper&#34;,
    &#34;It&#39;s dead Jim&#34;,
    &#34;We seek peaceful coexistence&#34;,
    &#34;It&#39;s a good day to die&#34;)

    var sentiments = sentences.stream().
        map(Sentence::new).
        map(Sentence::sentiment).
        map(SentimentClass::toString).
        toList()

    Table.create(&#34;\n&#34;).
        addColumns(
            StringColumn.create(&#34;Senntence&#34;, sentences),
            StringColumn.create(&#34;Sentiment&#34;, sentiments))
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>          Senntence            |  Sentiment  |
</span></span><span style=display:flex><span>----------------------------------------------
</span></span><span style=display:flex><span>        Live long and prosper  |    NEUTRAL  |
</span></span><span style=display:flex><span>                It&#39;s dead Jim  |   NEGATIVE  |
</span></span><span style=display:flex><span> We seek peaceful coexistence  |    NEUTRAL  |
</span></span><span style=display:flex><span>       It&#39;s a good day to die  |    NEUTRAL  |
</span></span></code></pre></div></div><div class=post-footer></div></article></main></body></html>